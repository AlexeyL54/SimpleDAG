# SimpleDAG

Проект **SimpleDAG** представляет собой систему для обработки данных из CSV-файлов с использованием направленного ациклического графа (DAG). Программа позволяет настраивать операции через YAML-конфигурации и выполнять их в определенной последовательности, задаваемой пользователем через схему графа.

## Содержание

- [Обзор](#обзор)
- [Структура проекта](#структура-проекта)
- [Требования](#требования)
- [Сборка проекта](#сборка-проекта)
- [Использование](#использование)
- [Конфигурация](#конфигурация)
- [Тестирование](#тестирование)
- [Архитектура](#архитектура)
- [Лицензия](#лицензия)

## Обзор

SimpleDAG позволяет:
- Загружать данные из CSV-файлов
- Настраивать операции обработки данных через YAML-конфигурации
- Строить граф выполнения операций на основе пользовательской схемы
- Выполнять операции в правильном порядке с использованием обхода в глубину
- Логировать результаты выполнения операций

Поддерживаемые операции:
- **Числовые**: сумма (`sum`), среднее значение (`average`)
- **Строковые**: конкатенация (`concatinate`)

## Структура проекта

```
.
├── data/                 # Директория с данными и конфигурациями
│   ├── test.csv         # Пример CSV-файла с данными
│   ├── test.yaml        # Пример YAML-конфигурации
│   └── *.yaml           # Другие конфигурационные файлы
├── docs/                # Документация
├── include/             # Заголовочные файлы
│   ├── graph.h         # Структуры и функции для работы с графами
│   ├── graphics.h      # Графические элементы (логотип, инструкции)
│   ├── operations.h    # Операции обработки данных
│   ├── parser.h        # Парсеры конфигураций и CSV
│   ├── router.h        # Маршрутизатор утилиты [ДОБАВЛЕНО]
│   └── utils.h         # Вспомогательные утилиты
├── libs/               # Внешние библиотеки
│   └── Tiny_Yaml/     # Парсер YAML-файлов
├── src/               # Исходный код
│   ├── graph.cpp      # Реализация работы с графами
│   ├── operations.cpp # Реализация операций
│   ├── parser.cpp     # Реализация парсеров
│   ├── router.cpp     # Реализация маршрутизатора
│   └── utils.cpp      # Реализация утилит
├── tests/             # Тесты
│   ├── graph/         # Тесты графов
│   ├── operations/    # Тесты операций
│   ├── parser/        # Тесты парсеров
│   ├── router/        # Тесты маршрутизатора
│   └── utils/         # Тесты утилит
├── main.cpp           # Главная программа
├── Makefile          # Файл сборки
└── README.md         # Документация```

## Требования

- g++ с поддержкой C++17
- **Make** утилита для сборки
- **Git** для клонирования репозитория
- **googletest** для тестов
- Совместимые OS: **Ubuntu**, **Arch Linux**, **Mac os**

## Сборка и запуск

### 1. Установка зависимостей

#### Ubuntu

```bash 
sudo apt-get update
sudo apt-get install -y build-essential libgtest-dev

cd /usr/src/gtest
sudo cmake CMakeLists.txt
sudo make
sudo cp lib/*.a /usr/lib
```

#### Arch Linux 

```bash 
sudo pacman -Syu
sudo pacman -S gtest
```

#### Mac OS

```bash 
brew update
brew install googletest
```

### 2. Клонирование репозитория

```bash
git clone https://github.com/AlexeyL54/SimpleDAG.git
```

```bash
cd SimpleDAG
```

### 3. Сборка основной программы

```bash
make
```

```bash
./SimpleDAG.out
```

### 4. Сборка и запуск тестов

Тесты расположены в соответствующих поддиректориях `tests/`.

Тесты покрывают:
- Создание и управление графами
- Корректность операций обработки данных
- Парсинг конфигураций и CSV-файлов
- Вспомогательные утилиты и логирование

```bash
# Сборка всех тестов
./buildTests.sh
```

```bash
# Или сборка отдельных тестов
# Доступно только на Ubuntu, Arch linux
cd tests
```

```bash 
# Сборка тестов операций
cd operations && make
```

```bash
# Сборка тестов функций для работы с графами
cd graph && make
```

```bash 
# Сборка тестов парсеров
cd parser && make
```

```bash
# Сборка тестов утилит
cd utils && make
```

```bash
# Запуск всех тестов
./runTests.sh

# Запуск отдельных тестов
./tests/operations/test_operations.out
./tests/graph/test_graph.out
./tests/parser/test_parser.out
./tests/utils/test_utils.out
```

## Использование

### 1. Подготовка данных

Поместите CSV-файл с данными и YAML-конфигурацию в директорию `data/`. В YAML-конфигурации пропишите название CSV-файла, который хотите обработать.

### 2. Процесс работы

1. **Выбор конфигурации**: Программа отобразит список доступных YAML-файлов в директории `data/`
2. **Проверка конфигурации**: Система проверит наличие всех указанных операций
3. **Просмотр операций**: Будет отображен список доступных операций с их идентификаторами
4. **Ввод схемы графа**: Пользователь вводит последовательности операций в формате `1->2->3`
5. **Выполнение**: Программа построит граф и выполнит операции в правильном порядке
6. **Логирование**: Результаты сохраняются в файл лога с меткой времени

### 4. Формат ввода схемы графа

```
1->2->3
1->4->5
2->4
end
```

Это создаст граф, где:
- Операция 1 выполняется перед 2 и 4
- Операция 2 выполняется перед 3 и 4
- Операция 4 выполняется перед 5

Если ввести
```
1->2->3 
4->5
```
Ветвь `4->5` не выполнится

Если ввести 
```
1-2->3 
```
или
```
1>2->3
```
операция с индексом 2 не будет выполнена.

## Конфигурация

### Пример YAML-конфигурации (`data/test.yaml`)

```yaml
path: test.csv
operations:
  sum_elements_of_column_1:
    func: sum
    column: 0
  average_of_column_1:
    func: average
    column: 0
  concat_strings:
    func: concatinate
    column: 3
```

### Поля конфигурации:

- **path**: путь к CSV-файлу относительно директории `data/`
- **operations**: словарь операций, где:
  - Ключ: уникальный идентификатор операции
  - **func**: тип операции (`sum`, `average`, `concatinate`)
  - **column**: номер столбца для обработки (начинается с 0)

## Архитектура

### Основные компоненты:

1. **Graph Module** (`graph.h/cpp`): Управление направленным ациклическим графом операций
2. **Operations Module** (`operations.h/cpp`): Реализация операций обработки данных
3. **Parser Module** (`parser.h/cpp`): Чтение конфигураций YAML и CSV-файлов
4. **Utils Module** (`utils.h/cpp`): Вспомогательные функции, TUI и логирование
5. **Graphics Module** (`graphics.h`): Визуальные элементы интерфейса
6. **Routing module** (`router.h/cpp`): Маршрутизация утилиты

### Поток данных:

1. Загрузка конфигурации YAML
2. Чтение CSV-данных
3. Построение графа операций на основе пользовательской схемы
4. Обход графа в глубину и выполнение операций
5. Сохранение результатов в лог-файл

## Лицензия

Проект использует библиотеку Tiny_Yaml, распространяемую под собственной лицензией. Смотрите `libs/Tiny_Yaml/LICENSE` для подробностей.

Основной код проекта распространяется под лицензией MIT.
